<!DOCTYPE html>
    <head>
        <title>商品總覽</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="UTF-8">

        <!--載入Bootstrap css-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

        <!--載入style.css、switch.css-->
        <link href="css/style.css" rel="stylesheet" type="text/css" />
        <link href="css/component-custom-switch.min.css" rel="stylesheet" type="text/css" />

        <!--載入Vue3-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.0.2/vue.global.js"></script>

        <!--載入axios-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>
    </head>

    <body>
        <div id="products" class="container">
            <div class="row py-3">
                <div  class="col-md-12 col-lg-12">
                    <h2>產品列表</h2>
                    <table class="table-hover mt-4" style="width:100%">
                        <thead>
                            <tr style="border-bottom: 2px solid black;">
                                <th>產品名稱</th>
                                <th>原價</th>
                                <th>售價</th>
                                <th>是否啟用</th>
                                <!-- <th>查看細節</th> -->
                                <th>編輯</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item,i) in productsList" :id="'product_' + item.id" style="border-bottom: 1px solid rgba(136, 136, 136, 0.4);">
                                <td>{{item.title}}</td>
                                <td>{{item.origin_price}}</td>
                                <td>{{item.price}}</td>
                                <!--是否啟用Def判斷(Start)-->
                                <td v-if="item.is_enabled" class="custom-switch custom-switch-label-yesno custom-switch-sm pl-0">
                                    <input class="custom-switch-input" :id="'isEnable_'+item.id" type="checkbox" checked>
                                    <label class="custom-switch-btn" :for="'isEnable_'+item.id"></label>
                                </td>
                                <td v-if="!item.is_enabled" class="custom-switch custom-switch-label-yesno custom-switch-sm pl-0">
                                    <input class="custom-switch-input" :id="'isEnable_'+item.id" type="checkbox">
                                    <label class="custom-switch-btn" :for="'isEnable_'+item.id"></label>
                                </td>
                                <!--是否啟用Def判斷(End)-->
                                <!-- <td><button v-on:click = "ProductDetail(item.id)" type="button" class="btn btn-primary">查看細節</button></td> -->
                                <td>
                                    <span style="padding-right: 10px;"><button v-on:click = "" type="button" class="btn btn-primary">編輯</button></span>
                                    <span><button v-on:click = "" type="button" class="btn btn-danger">刪除</button></span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div id="totalProduct" class="mt-4">目前有 {{productsTotal}} 項產品</div>
                </div>
                
                <!-- <div class="col-md-6">
                    <h2>單一產品細節</h2>
                    <span v-if="!productDetail.is_enabled" style="color: gray;">請選擇一個商品查看</span>
                        <div id="product_Border">
                            <div v-if="productDetail.is_enabled" >
                            商品圖片
                            <div class="center_vertically" >
                                <img v-bind:src='productDetail.imageUrl' style="height:300px; margin: 0px 20px 20px 20px"/>
                            </div>
                            商品明細
                            <div class="m-4" style="justify-content:center;">
                                <h5>{{productDetail.title}}<span class="badge bg-primary ms-3" style="padding: 0.5em 0.65em;">{{productDetail.category}}</span></h5>
                                <p v-if="productDetail.description !=null">商品描述：{{productDetail.description}}</p>
                                <p v-if="productDetail.size !=null">商品內容：尺寸：{{productDetail.size}}</p>
                                如售價為空，則顯示原價
                                <p v-if="productDetail.price == '' ||  productDetail.price == null">
                                    {{productDetail.origin_price}}
                                </p>
                                <p v-else>{{productDetail.price}} <del>{{productDetail.origin_price}}</del> 個/元</p>
                            </div>
                        </div>
                    </div>
                    商品圖片明細
                    <div v-if="productDetail.is_enabled" style="margin:40px 0px">
                        <span v-for="(item) in productDetail.imagesUrl">
                            <img v-bind:src='item' style="height:150px; margin-right:20px"/>
                        </span>
                    </div>
                </div> -->
            </div>
        </div>
    </body>
</html>

<script type="module">
    /*載入Products Data*/
    //import {products} from './js/Products.js'

    Vue.createApp({
        data(){
            return {
                productsList:{},  //產品項目
                productDetail:{}, //產品明細
                productsTotal:0,  //產品總數
                api:{
                    baseUrl : 'https://vue3-course-api.hexschool.io/v2/api/',
                    signCheck:'user/check',
                    apiUrl : '/admin/products/all',
                    apiPath: 'timmyhuang_api'
                }
            }
        },
        methods:{
            //取得產品明細
            // ProductDetail(productId){
            //     this.productDetail = this.productsList[productId] //指定產品明細
                
            //     //取得是否啟用的狀態
            //     var isEnable_Element = document.querySelector('#isEnable_' + productId);
            //     this.productDetail.is_enabled = isEnable_Element.checked

            //     //查看細節時，新增div邊框
            //     var border_Element = document.querySelector('#product_Border');
            //     if(this.productDetail.is_enabled){
            //         border_Element.style = "border:1px solid rgba(136, 136, 136, 0.4);";
            //     }else{
            //         border_Element.style = "";
            //     }
            // },
            GetProductDetail(){
                axios.get(this.api.baseUrl + this.api.apiPath + this.api.apiUrl)
                .then((res) => {
                    if(res.data.success){
                        this.productsList = res.data.products
                        this.productsTotal = Object.keys(this.productsList).length;
                    }
                })
                .catch((err) => {
                    alert(err);
                })
            },
            CheckLogin(){
                const token = document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*\=\s*([^;]*).*$)|^.*$/, "$1");
                axios.defaults.headers.common['Authorization'] = token;

                axios.post(this.api.baseUrl + this.api.signCheck)
                .then((res) => {
                    console.log(token);
                    this.GetProductDetail(); //取得全部產品項目
                })
                .catch((err) => {
                    alert(err);
                })
            }
        },
        mounted() {
            this.CheckLogin();
        }
    }).mount('#products')
</script>